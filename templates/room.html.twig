{% extends 'base.html.twig' %}

{% block title %}Učebna {{ room.getFullName() }}{% endblock %}

{% block js %}
    <script src="/js/room.js" defer></script>
{% endblock %}

{% block content %}
    <h1>Učebna {{ room.getFullName() }}</h1>
    <div id="top-block" class="form-block" data-room-id="{{ room.id }}" data-room-name="{{ room.getFullName() }}">
        <section class="info">
            <span>Budova:</span>
            <span>{{ room.building }}</span>

            <span>Místnost:</span>
            <span>{{ room.name }}</span>

            <span>Stav:</span>
            <span>{% if is_occupied %}Obsazená{% else %}Volná{% endif %}</span>

            <span>Dostupnost</span>
            <span>
                {% if room.isPublic %}
                    Veřejná
                {% else %}
                    Soukromá
                {% endif %}
            </span>

            <span>Skupina</span>
            <span>
                {% if room.group %}
                    {{ room.group.name }}
                {% else %}
                    Žádná skupina
                {% endif %}
            </span>

            <span>Mám přístup?</span>
            <span>{% if is_bookable %}Ano{% else %}Ne{% endif %}</span>

            {% if is_bookable or is_granted('ROLE_ADMIN') %}
                <span>Rezervace</span>
                <a href="{{ path('app_book', {'room': room.id}) }}">
                    Rezervovat{% if is_manageable or is_granted('ROLE_ADMIN') %} jako správce{% endif %}
                </a>
            {% endif %}
        </section>

        <div>
            <h3>Správci</h3>
            <table>
                <thead>
                <tr>
                    <th>Jméno</th>
                    {% if is_granted('ROLE_ADMIN') or is_group_manageable %}
                        <th><img class="fa" src="/images/trash-red.svg" alt="Odebrat správce"></th>
                    {% endif %}
                </tr>
                </thead>
                <tbody id="managers-table-body">
                {% if room.managers is empty %}
                    <tr>
                        <td colSpan="2">Žádný správce</td>
                    </tr>
                {% endif %}
                {% for manager in room.managers %}
                    <tr id="manager-{{ manager.id }}">
                        <td>{{ manager.name }}</td>
                        {% if is_granted('ROLE_ADMIN') or is_group_manageable %}
                            <td>
                                <img class="wide a" src="/images/trash-red.svg" alt="Odebrat správce"
                                     onclick="deleteManagerFromRoom({{ room.id }}, '{{ room.name }}', {{ manager.id }}, '{{ manager.name }}')">
                            </td>
                        {% endif %}
                    </tr>
                {% endfor %}
                </tbody>
            </table>

            {% if is_granted('ROLE_ADMIN') or is_group_manageable %}
                <form id="new-manager-form">
                    <label for="new-manager">Přidat správce</label>
                    <select id="new-manager" name="new-manager">
                        {% for manager_option in manager_options %}
                            <option value="{{ manager_option.id }}">{{ manager_option.name }}</option>
                        {% endfor %}
                    </select>
                    <button type="submit" id="new-manager-save-button">Přidat správce</button>
                </form>
            {% endif %}
        </div>

        {% if is_granted('ROLE_ADMIN') %}
            <form action="{{ path('app_room_change_room', {'id': room.id}) }}" method="post">
                <h2>Změnit místnost</h2>
                <div class="form-fields">
                    <label for="room">Nová místnost:</label>
                    <input type="text" id="room" name="_room" required>
                </div>

                <button type="submit">Změnit místnost</button>
            </form>

            <form action="{{ path('app_room_change_building', {'id': room.id}) }}" method="post">
                <h2>Změnit budovu</h2>
                <div class="form-fields">
                    <label for="building">Nová budova</label>
                    <input type="text" id="building" name="_building" required>
                </div>

                <button type="submit">Změnit budovu</button>
            </form>

            <form action="{{ path('app_room_change_availability_for_the_public', {'id': room.id}) }}" method="post">
                <h2>Změnit přístupnost pro veřejnost</h2>
                <div class="form-fields">
                    <label for="is_public">Veřejná?</label>
                    <input type="checkbox" id="is_public" name="_is_public" {% if room.isPublic %}checked{% endif %}>
                </div>

                <button type="submit">Změnit přístupnost pro veřejnost</button>
            </form>

            <form action="{{ path('app_room_change_group', {'roomId': room.id}) }}" method="post">
                <h2>Změnit skupiny do které učebna spadá</h2>
                <div class="form-fields">
                    <label for="group">Vyberte skupinu.</label>
                    <select name="_group" id="group">
                        <option value="-1">Žádná</option>
                        {% for existingGroup in groups | sort((a, b) => a.name <=> b.name) %}
                            <option value="{{ existingGroup.id }}">{{ existingGroup.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <button type="submit">Změnit skupinu místnosti</button>
            </form>
        {% endif %}
    </div>
{% endblock %}
